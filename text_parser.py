import re


# ---------- –ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–Ø ----------

def normalize(text: str) -> str:
    """
    –ü—Ä–∏–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç –∫ —É–¥–æ–±–Ω–æ–º—É –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤–∏–¥—É
    """
    text = text.lower()
    text = text.replace("—ë", "–µ")
    text = re.sub(r"[.,;:!?\n\r\t]", " ", text)
    text = re.sub(r"\s+", " ", text)
    return text.strip()


# ---------- –ü–õ–ê–ù–û–í–û–ï / –ê–í–ê–†–ò–ô–ù–û–ï ----------

def is_planned(text: str) -> bool:
    t = normalize(text)
    return "–ø–ª–∞–Ω" in t or "–ø–ª–∞–Ω–æ–≤" in t


# ---------- –°–õ–û–í–ê–†–¨ –§–û–†–ú –†–ï–°–£–†–°–û–í ----------

RESOURCE_FORMS = {
    # üîµ –í–û–î–ê (—Ö–æ–ª–æ–¥–Ω–∞—è)
    "–≤–æ–¥–∞": [
        "–≤–æ–¥–∞",
        "–≤–æ–¥—ã",
        "–≤–æ–¥–µ",
        "–≤–æ–¥–æ–π",
        "–±–µ–∑ –≤–æ–¥—ã",
        "–≤–æ–¥–æ—Å–Ω–∞–±–∂",          # –≤–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ
    ],

    # üî¥ –ì–û–†–Ø–ß–ê–Ø –í–û–î–ê
    "–≥–æ—Ä—è—á–∞—è –≤–æ–¥–∞": [
        "–≥–æ—Ä—è—á–∞—è –≤–æ–¥–∞",
        "–≥–æ—Ä—è—á–µ–π –≤–æ–¥—ã",
        "–≥–≤—Å",
        "–≥–æ—Ä—è—á–µ–µ –≤–æ–¥–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ",
    ],

    # ‚ö° –°–í–ï–¢
    "—Å–≤–µ—Ç": [
        "—Å–≤–µ—Ç",
        "—Å–≤–µ—Ç–∞",
        "—Å–≤–µ—Ç–µ",
        "—ç–ª–µ–∫—Ç—Ä–æ",
        "—ç–ª–µ–∫—Ç—Ä–∏—á",           # —ç–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ, —ç–ª–µ–∫—Ç—Ä–æ—Å–Ω–∞–±–∂–µ–Ω–∏–µ
    ],

    # üî• –ì–ê–ó
    "–≥–∞–∑": [
        "–≥–∞–∑",
        "–≥–∞–∑–∞",
        "–≥–∞–∑–µ",
        "–≥–∞–∑–æ—Å–Ω–∞–±–∂",
    ],

    # üå° –û–¢–û–ü–õ–ï–ù–ò–ï
    "–æ—Ç–æ–ø–ª–µ–Ω–∏–µ": [
        "–æ—Ç–æ–ø–ª–µ–Ω–∏–µ",
        "–æ—Ç–æ–ø–ª–µ–Ω–∏—è",
        "—Ç–µ–ø–ª–æ",
        "—Ç–µ–ø–ª–æ—Å–Ω–∞–±–∂",
        "—Ç–µ–ø–ª–æ—Å–µ—Ç—å",
    ],

    # üåê –ò–ù–¢–ï–†–ù–ï–¢
    "–∏–Ω—Ç–µ—Ä–Ω–µ—Ç": [
        "–∏–Ω—Ç–µ—Ä–Ω–µ—Ç",
        "–∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞",
        "—Å–≤—è–∑–∏",
        "–¥–æ—Å—Ç—É–ø–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç",
        "—Å–µ—Ç",
        "wi fi",
        "wifi",
    ],
}


# ---------- –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê ----------

def match_message(text: str, city: str, street: str, resources: list) -> bool:
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –ø–æ–¥—Ö–æ–¥–∏—Ç –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
    –ì–æ—Ä–æ–¥ ‚Äî –ù–ï –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π.
    –†–µ—Å—É—Ä—Å—ã ‚Äî —Å —É—á—ë—Ç–æ–º –ø–∞–¥–µ–∂–µ–π –∏ —Ñ–æ—Ä–º.
    """
    t = normalize(text)

    print("      üîé –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è")
    print(f"         —Ç–µ–∫—Å—Ç: {text}")
    print(f"         –≥–æ—Ä–æ–¥: {city}")
    print(f"         —É–ª–∏—Ü–∞: {street}")
    print(f"         —Ä–µ—Å—É—Ä—Å—ã: {resources}")

    # ---------- –ì–û–†–û–î (–ù–ï –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ô) ----------
    if city:
        city_n = normalize(city)
        if city_n in t:
            print("      ‚úÖ –≥–æ—Ä–æ–¥ –Ω–∞–π–¥–µ–Ω")
        else:
            print("      ‚ö† –≥–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º)")
    else:
        print("      ‚Ñπ –≥–æ—Ä–æ–¥ –Ω–µ –∑–∞–¥–∞–Ω")

    # ---------- –£–õ–ò–¶–ê ----------
    if street:
        street_n = normalize(street)

        street_variants = {
            street_n,
            f"—É–ª {street_n}",
            f"—É–ª–∏—Ü–∞ {street_n}",
            f"–Ω–∞ —É–ª–∏—Ü–µ {street_n}",
        }

        if not any(v in t for v in street_variants):
            print("      ‚ùå —É–ª–∏—Ü–∞ –ù–ï –Ω–∞–π–¥–µ–Ω–∞")
            return False

        print("      ‚úÖ —É–ª–∏—Ü–∞ –Ω–∞–π–¥–µ–Ω–∞")
    else:
        print("      ‚Ñπ —É–ª–∏—Ü–∞ –Ω–µ –∑–∞–¥–∞–Ω–∞")

    # ---------- –†–ï–°–£–†–°–´ ----------
    for r in resources:
        r_n = normalize(r)

        forms = RESOURCE_FORMS.get(r_n, [r_n])

        for form in forms:
            if form in t:
                print(f"      ‚úÖ –Ω–∞–π–¥–µ–Ω —Ä–µ—Å—É—Ä—Å: {r} (—Ñ–æ—Ä–º–∞: {form})")
                return True

    print("      ‚ùå –Ω–∏ –æ–¥–∏–Ω —Ä–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω")
    return False
